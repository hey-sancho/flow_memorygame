import lib/tropic/tropic_ui;

Card(
	face: TColor,
	opened: DynamicBehaviour<bool>,
	solved: DynamicBehaviour<bool>,
);

COLORS = [
	TGreen(),
	TRed(),
	TBlue(),
	TYellow(),
	TWhite(),
	TBlack(),
];

MATCH = 2; // number of cards to match
COLS = 4;

drawCard(color: TColor) -> Tropic {
	size = TFixed(150.0, 150.0);

	card = Card(color, make(false), make(false));
	toggleCard = \ -> reverseBehaviour(card.opened);

	button = TSelect(card.opened, \opened -> {
		faceColor = if (opened) card.face else TDarkGrey();
		TTextButton("", "", [faceColor, TForeground(size)], [TOnClicked(toggleCard)]);
	});

	TBorder4(2.0, button);
}

main() {
	header = TText("Memory game", [FontSize(20.0)]);

	colorsLen = length(COLORS)
	faces = generate(0, colorsLen * MATCH, \i -> COLORS[i % colorsLen]);

	cards = map(shuffleArray(faces), drawCard);
	cardGrid = TGrid(splitByNumber(cards, COLS));

	view = TLinesXCenter([
		header,
		TFrame(40.0, 0.0, [Fill(0xe3e3e3)], cardGrid)
	]) |> TCenterX;

	trender(view, []);
}
